
DSTESTALL_TARGET := $(DS_BINDIR)/TestAll

_DSTESTALL_SRC	:= TestAll.c
_DSTESTALL_OBJ	:= TestAll.o

_DSTEST_SRCS := ringbuf_test.c
_DSTEST_OBJS := $(_DSTEST_SRCS:.c=.o)

DSTEST_SRCS 	:= $(patsubst %, $(DS_TESTDIR)/%,$(_DSTEST_SRCS))

DSTESTSING_OBJS	:= $(patsubst %, $(DSTESTSING_OBJDIR)/%,$(_DSTEST_OBJS))
DSTESTALL_SRC	:= $(patsubst %, $(DS_TESTDIR)/%,$(_DSTESTALL_SRC))
DSTESTALL_OBJ	:= $(patsubst %, $(DSTESTALL_OBJDIR)/%,$(_DSTESTALL_OBJ))
DSTESTALL_OBJS	:= $(patsubst %, $(DSTESTALL_OBJDIR)/%,$(_DSTEST_OBJS))

$(info DSTESTALL_SRC     = $(DSTESTALL_SRC))
$(info DSTEST_SRCS       = $(DSTEST_SRCS))

$(info DSTESTALL_OBJ     = $(DSTESTALL_OBJ))
$(info DSTESTALL_OBJS    = $(DSTESTALL_OBJS))
$(info DSTESTSING_OBJS   = $(DSTESTSING_OBJS))

$(info DSTESTALL_OBJDIR  = $(DSTESTALL_OBJDIR))
$(info DSTESTSING_OBJDIR = $(DSTESTSING_OBJDIR))
$(info DS_LIBOUT = $(DS_LIBOUT))
$(info DS_OBJS = $(DS_OBJS))
.PHONY: ds_testall

ds_testall: $(DS_LIBOUT) $(DSTESTALL_OBJS) $(DSTESTALL_TARGET)

$(DSTESTALL_TARGET): $(DSTESTALL_OBJ) 
	$(CC) $(DSTEST_INCFLAGS) $< $(DSTESTALL_OBJS) -o $@ $(DS_LIBFLAGS)

$(DSTESTALL_OBJ): $(DSTESTALL_SRC)
	$(CC) $(TESTALL_CFLAGS) $(DSTEST_INCFLAGS) -c $^ -o $@ 	

$(DSTESTALL_OBJDIR)/%.o: $(DS_TESTDIR)/%.c
	$(CC) $(TESTALL_CFLAGS) $(DSTEST_INCFLAGS) -c $< -o $@

$(DSTESTSING_OBJDIR)/%.o: $(DS_TESTDIR)/%.c 
	$(CC) $(TESTSINGLE_CFLAGS) $(DSTEST_INCFLAGS) -c $< -o $@
